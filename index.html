<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSK2 Yangi So'zlar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Noto Serif SC å­—ä½“ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --uz-blue: #0099B5;
            --uz-green: #1EB53A;
            --slate-800: #1e293b;
            --china-red: #b91c1c; /* æ·±ä¸­å›½çº¢ */
            --paper-beige: #fffbf0; /* å®£çº¸ç±³è‰² */
        }

        body {
            background-color: #fdfcf8;
            /* æ›´åŠ æ·¡é›…çš„èƒŒæ™¯çº¹ç† */
            background-image: radial-gradient(rgba(211, 47, 47, 0.05) 0.5px, transparent 0.5px);
            background-size: 20px 20px;
            background-position: 0 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        /* ç¿»è½¬å®¹å™¨æ ·å¼ */
        .card-container {
            perspective: 1000px;
            aspect-ratio: 4/5;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s cubic-bezier(0.4, 0.0, 0.2, 1);
            transform-style: preserve-3d;
            cursor: pointer;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .card-inner:hover {
            box-shadow: 0 10px 20px -3px rgba(185, 28, 28, 0.25); /* çº¢è‰²é˜´å½± */
        }

        .card-inner.is-flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 1rem;
            overflow: hidden;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .card-front {
            border-bottom: 4px solid var(--china-red); /* æ­£é¢æ”¹ä¸ºçº¢è‰²è¾¹æ¡† */
        }

        .card-back {
            transform: rotateY(180deg);
            background: #ffffff;
            border-bottom: 4px solid var(--uz-green);
            padding: 0;
        }

        .noselect {
            user-select: none;
            -webkit-user-select: none;
        }
        
        /* ä¸­å¼å•è‰²èƒŒæ™¯æ¡†æ ·å¼ */
        .chinese-frame {
            position: relative;
            display: inline-block;
            background-color: var(--paper-beige);
            /* åŒçº¿è¾¹æ¡†ï¼Œç»å…¸ä¸­å¼é£æ ¼ */
            border: 4px double var(--china-red);
            border-radius: 8px;
            padding: 12px 30px;
            box-shadow: 0 4px 15px rgba(185, 28, 28, 0.15);
            /* å­—ä½“è®¾ç½® */
            font-family: 'Noto Serif SC', serif;
            color: var(--china-red);
            font-weight: 700;
            text-align: center;
        }

        /* å››è§’è£…é¥° (ç®€æ˜“å›çº¹é£æ ¼) */
        .chinese-frame::before, .chinese-frame::after {
            content: '';
            position: absolute;
            width: 10px;
            height: 10px;
            border: 2px solid var(--china-red);
            transition: all 0.3s ease;
        }

        /* å·¦ä¸Šè§’ */
        .chinese-frame::before {
            top: 4px;
            left: 4px;
            border-right: none;
            border-bottom: none;
        }

        /* å³ä¸‹è§’ */
        .chinese-frame::after {
            bottom: 4px;
            right: 4px;
            border-left: none;
            border-top: none;
        }

        /* é¢å¤–çš„ä¸¤ä¸ªè§’ç”¨å†…éƒ¨å…ƒç´ æ¨¡æ‹Ÿ */
        .corner-tr, .corner-bl {
            position: absolute;
            width: 10px;
            height: 10px;
            border: 2px solid var(--china-red);
        }
        /* å³ä¸Šè§’ */
        .corner-tr {
            top: 4px;
            right: 4px;
            border-left: none;
            border-bottom: none;
        }
        /* å·¦ä¸‹è§’ */
        .corner-bl {
            bottom: 4px;
            left: 4px;
            border-right: none;
            border-top: none;
        }
        
        /* æ ‡é¢˜è£…é¥° */
        .title-decoration::before,
        .title-decoration::after {
            content: 'ğŸ®';
            margin: 0 0.5rem;
            font-size: 1.5rem;
            vertical-align: middle;
        }

        /* Modal åŠ¨ç”» */
        #ai-modal {
            transition: opacity 0.2s ease-in-out;
        }
        #ai-modal.hidden {
            opacity: 0;
            pointer-events: none;
        }
        #ai-modal:not(.hidden) {
            opacity: 1;
            pointer-events: auto;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid var(--uz-blue);
            width: 24px;
            height: 24px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-4 md:p-6 relative">

    <!-- AI Modal (å¯¹è¯æ¡†) -->
    <div id="ai-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full p-6 transform transition-all scale-100 border border-slate-100">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center gap-2 text-[#0099B5]">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" />
                    </svg>
                    <h3 class="font-bold text-lg">AI Misol (Example)</h3>
                </div>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors p-1 rounded-full hover:bg-gray-100">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <div id="modal-content" class="space-y-3 text-slate-700 ai-content min-h-[100px]">
                <!-- AI å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
            </div>

            <div id="modal-loading" class="hidden flex flex-col items-center justify-center py-6">
                <div class="loader mb-3"></div>
                <p class="text-sm text-slate-500 font-medium animate-pulse">Jumla tuzilmoqda... (Generating...)</p>
            </div>
            
            <div class="mt-4 pt-4 border-t border-slate-100 flex justify-end">
                <button onclick="speakAiContent()" class="text-[#0099B5] hover:bg-cyan-50 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 14.142m-5.598-9.543a3 3 0 010 4.242M7 10v4h3l3.586 3.586a2 2 0 002.414.586V5.828a2 2 0 00-2.414.586L10 10H7z" />
                    </svg>
                    Eshitish
                </button>
            </div>
        </div>
    </div>

    <!-- é¡¶éƒ¨æ ‡é¢˜ -->
    <header class="text-center mb-10 py-6 relative">
        <!-- é¡¶éƒ¨å¤§æ ‡é¢˜ -->
        <div class="flex items-center justify-center gap-3 mb-6">
            <div class="w-12 h-12 rounded-full bg-[#b91c1c] flex items-center justify-center text-white font-bold text-2xl shadow-lg border-4 border-[#FFD700]">æ±‰</div>
            <h1 class="text-3xl md:text-4xl font-extrabold text-slate-800 tracking-tight title-decoration">HSK2 Yangi So'zlar</h1>
        </div>
        
        <!-- çªå‡ºæ˜¾ç¤ºçš„å‰¯æ ‡é¢˜ (ä¸­å¼å•è‰²æ¡†) -->
        <div class="relative z-10">
            <div class="chinese-frame">
                <!-- é¢å¤–çš„è§’è£…é¥° -->
                <div class="corner-tr"></div>
                <div class="corner-bl"></div>
                
                <p id="subtitle-text" class="text-xl md:text-2xl tracking-wide leading-relaxed">
                    Dilfuza KÄng lÇo shÄ« bilan xitoy tilini o'rganmiz
                </p>
            </div>
        </div>

        <!-- è£…é¥°æ€§ç¥¥äº‘ -->
        <div class="absolute top-0 left-0 opacity-15 pointer-events-none">
             <svg width="100" height="60" viewBox="0 0 100 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 20C20 8.9543 28.9543 0 40 0C51.0457 0 60 8.9543 60 20V40C60 51.0457 51.0457 60 40 60C28.9543 60 20 51.0457 20 40H0V20H20Z" fill="#b91c1c"/>
                <path d="M60 20C60 8.9543 68.9543 0 80 0C91.0457 0 100 8.9543 100 20V40C100 51.0457 91.0457 60 80 60C68.9543 60 60 51.0457 60 40V20Z" fill="#b91c1c"/>
            </svg>
        </div>
        <div class="absolute bottom-0 right-0 opacity-15 pointer-events-none transform rotate-180">
             <svg width="100" height="60" viewBox="0 0 100 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 20C20 8.9543 28.9543 0 40 0C51.0457 0 60 8.9543 60 20V40C60 51.0457 51.0457 60 40 60C28.9543 60 20 51.0457 20 40H0V20H20Z" fill="#b91c1c"/>
                <path d="M60 20C60 8.9543 68.9543 0 80 0C91.0457 0 100 8.9543 100 20V40C100 51.0457 91.0457 60 80 60C68.9543 60 60 51.0457 60 40V20Z" fill="#b91c1c"/>
            </svg>
        </div>

    </header>

    <!-- ç½‘æ ¼å®¹å™¨ -->
    <div id="grid-app" class="max-w-7xl mx-auto grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 md:gap-6 pb-20 relative z-10">
        <!-- å¡ç‰‡å°†é€šè¿‡ JS æ’å…¥åˆ°è¿™é‡Œ -->
    </div>

    <!-- åº•éƒ¨è¯´æ˜ -->
    <div class="text-center mt-12 text-slate-500 text-sm pb-8 border-t border-red-100 pt-6 mx-auto max-w-lg relative z-10">
        Jami so'zlar: <span id="total-count" class="font-bold text-[#b91c1c] text-lg">0</span>
    </div>

    <script>
        // API Key Setup
        const apiKey = ""; // The runtime environment will provide the key automatically.

        // HSK 2 æ•°æ®æº (Based on Hsk2 sozlari uzbek tilida.pdf)
        const vocabData = [
            { zh: "å§", py: "ba", uz: "Buyruq/So'roq qo'shimchasi", icon: "â“" },
            { zh: "ç™½", py: "bÃ¡i", uz: "Oq rang", icon: "âšª" },
            { zh: "å¸®åŠ©", py: "bÄngzhÃ¹", uz: "Yordam", icon: "ğŸ¤" },
            { zh: "æŠ¥çº¸", py: "bÃ ozhÇ", uz: "Gazeta", icon: "ğŸ“°" },
            { zh: "æ¯”", py: "bÇ", uz: "Nisbatan", icon: "âš–ï¸" },
            { zh: "åˆ«", py: "biÃ©", uz: "Boshqa", icon: "ğŸ›‘" },
            { zh: "ç™¾", py: "bÇi", uz: "Yuz (100)", icon: "ğŸ’¯" },
            { zh: "å®¾é¦†", py: "bÄ«nguÇn", uz: "Mehmonxona", icon: "ğŸ¨" },
            { zh: "é•¿", py: "chÃ¡ng", uz: "Uzun", icon: "ğŸ“" },
            { zh: "å”±æ­Œ", py: "chÃ nggÄ“", uz: "Qo'shiq aytish", icon: "ğŸ¤" },
            { zh: "å‡º", py: "chÅ«", uz: "Chiqmoq", icon: "ğŸšª" },
            { zh: "ç©¿", py: "chuÄn", uz: "Kiymoq", icon: "ğŸ‘•" },
            { zh: "æ¬¡", py: "cÃ¬", uz: "Marta", icon: "ğŸ”„" },
            { zh: "ä»", py: "cÃ³ng", uz: "Dan", icon: "â¡" },
            { zh: "é”™", py: "cuÃ²", uz: "Xato", icon: "âŒ" },
            { zh: "æ‰“ç¯®çƒ", py: "dÇ lÃ¡nqiÃº", uz: "Basketbol", icon: "ğŸ€" },
            { zh: "å¤§å®¶", py: "dÃ jiÄ", uz: "Hamma", icon: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦" },
            { zh: "åˆ°", py: "dÃ o", uz: "Yetib kelmoq", icon: "ğŸ" },
            { zh: "å¾—", py: "de", uz: "(Fe'l darajasi)", icon: "ğŸ‰" },
            { zh: "ç­‰", py: "dÄ›ng", uz: "Kutmoq", icon: "â³" },
            { zh: "å¼Ÿå¼Ÿ", py: "dÃ¬di", uz: "Uka", icon: "ğŸ‘¦" },
            { zh: "ç¬¬ä¸€", py: "dÃ¬yÄ«", uz: "Birinchi", icon: "ğŸ¥‡" },
            { zh: "æ‡‚", py: "dÇ’ng", uz: "Tushunmoq", icon: "ğŸ’¡" },
            { zh: "å¯¹", py: "duÃ¬", uz: "To'g'ri", icon: "âœ”ï¸" },
            { zh: "æˆ¿é—´", py: "fÃ¡ngjiÄn", uz: "Xona", icon: "ğŸ " },
            { zh: "éå¸¸", py: "fÄ“ichÃ¡ng", uz: "Juda", icon: "ğŸ‘" },
            { zh: "æœåŠ¡å‘˜", py: "fÃºwÃ¹yuÃ¡n", uz: "Ofitsiant", icon: "ğŸ¤µ" },
            { zh: "é«˜", py: "gÄo", uz: "Baland", icon: "ğŸ¦’" },
            { zh: "å‘Šè¯‰", py: "gÃ osu", uz: "Aytmoq", icon: "ğŸ—£ï¸" },
            { zh: "å“¥å“¥", py: "gÄ“ge", uz: "Aka", icon: "ğŸ§‘" },
            { zh: "ç»™", py: "gÄ›i", uz: "Bermoq", icon: "ğŸ¤²" },
            { zh: "å…¬å…±æ±½è½¦", py: "gÅnggÃ²ng qÃ¬chÄ“", uz: "Avtobus", icon: "ğŸšŒ" },
            { zh: "è´µ", py: "guÃ¬", uz: "Qimmat", icon: "ğŸ’°" },
            { zh: "è¿‡", py: "guo", uz: "O'tgan", icon: "ğŸ—“ï¸" },
            { zh: "è¿˜", py: "hÃ¡i", uz: "Yana", icon: "â•" },
            { zh: "å­©å­", py: "hÃ¡izi", uz: "Bola", icon: "ğŸ‘¶" },
            { zh: "å¥½åƒ", py: "hÇochÄ«", uz: "Mazali", icon: "ğŸ˜‹" },
            { zh: "é»‘", py: "hÄ“i", uz: "Qora", icon: "âš«" },
            { zh: "çº¢", py: "hÃ³ng", uz: "Qizil", icon: "ğŸ”´" },
            { zh: "ç«è½¦ç«™", py: "huÇ’chÄ“zhÃ n", uz: "Vokzal", icon: "ğŸš‰" },
            { zh: "æœºåœº", py: "jÄ«chÇng", uz: "Aeroport", icon: "âœˆï¸" },
            { zh: "é¸¡è›‹", py: "jÄ«dÃ n", uz: "Tuxum", icon: "ğŸ¥š" },
            { zh: "ä»¶", py: "jiÃ n", uz: "(Kiyim uchun)", icon: "ğŸ‘”" },
            { zh: "æ•™å®¤", py: "jiÃ oshÃ¬", uz: "Sinfxona", icon: "ğŸ«" },
            { zh: "å§å§", py: "jiÄ›jie", uz: "Opa", icon: "ğŸ‘©" },
            { zh: "ä»‹ç»", py: "jiÃ¨shÃ o", uz: "Tanishtirish", icon: "ğŸ¤" },
            { zh: "è¿›", py: "jÃ¬n", uz: "Kirmoq", icon: "ğŸš¶" },
            { zh: "è¿‘", py: "jÃ¬n", uz: "Yaqin", icon: "ğŸ“" },
            { zh: "å°±", py: "jiÃ¹", uz: "Aynan", icon: "ğŸ¯" },
            { zh: "è§‰å¾—", py: "juÃ©de", uz: "Menimcha", icon: "ğŸ¤”" },
            { zh: "å’–å•¡", py: "kÄfÄ“i", uz: "Qahva", icon: "â˜•" },
            { zh: "å¼€å§‹", py: "kÄishÇ", uz: "Boshlamoq", icon: "â–¶ï¸" },
            { zh: "è€ƒè¯•", py: "kÇoshÃ¬", uz: "Imtihon", icon: "ğŸ“" },
            { zh: "å¯èƒ½", py: "kÄ›nÃ©ng", uz: "Ehtimol", icon: "ğŸ²" },
            { zh: "å¯ä»¥", py: "kÄ›yÇ", uz: "Mumkin", icon: "ğŸ†—" },
            { zh: "è¯¾", py: "kÃ¨", uz: "Dars", icon: "ğŸ“š" },
            { zh: "å¿«", py: "kuÃ i", uz: "Tez", icon: "ğŸ†" },
            { zh: "å¿«ä¹", py: "kuÃ ilÃ¨", uz: "Xursand", icon: "ğŸ˜Š" },
            { zh: "ç¦»", py: "lÃ­", uz: "Dan (masofa)", icon: "â†”ï¸" },
            { zh: "ä¸¤", py: "liÇng", uz: "Ikki", icon: "2ï¸âƒ£" },
            { zh: "é›¶", py: "lÃ­ng", uz: "Nol", icon: "0ï¸âƒ£" },
            { zh: "è·¯", py: "lÃ¹", uz: "Yo'l", icon: "ğŸ›£ï¸" },
            { zh: "æ—…æ¸¸", py: "lÇšyÃ³u", uz: "Sayohat", icon: "ğŸ§³" },
            { zh: "å–", py: "mÃ i", uz: "Sotmoq", icon: "ğŸ›’" },
            { zh: "æ…¢", py: "mÃ n", uz: "Sekin", icon: "ğŸ¢" },
            { zh: "å¿™", py: "mÃ¡ng", uz: "Band", icon: "ğŸ˜«" },
            { zh: "æ¯", py: "mÄ›i", uz: "Har", icon: "ğŸ”" },
            { zh: "å¦¹å¦¹", py: "mÃ¨imei", uz: "Singil", icon: "ğŸ‘§" },
            { zh: "é—¨", py: "mÃ©n", uz: "Eshik", icon: "ğŸšª" },
            { zh: "é¢æ¡", py: "miÃ ntiÃ¡o", uz: "Makaron", icon: "ğŸœ" },
            { zh: "ç”·", py: "nÃ¡n", uz: "Erkak", icon: "â™‚ï¸" },
            { zh: "æ‚¨", py: "nÃ­n", uz: "Siz (Hurmat)", icon: "ğŸ™‡" },
            { zh: "ç‰›å¥¶", py: "niÃºnÇi", uz: "Sut", icon: "ğŸ¥›" },
            { zh: "å¥³", py: "nÇš", uz: "Ayol", icon: "â™€ï¸" },
            { zh: "æ—è¾¹", py: "pÃ¡ngbiÄn", uz: "Yonida", icon: "ğŸ‘‰" },
            { zh: "è·‘æ­¥", py: "pÇobÃ¹", uz: "Yugurmoq", icon: "ğŸƒ" },
            { zh: "ä¾¿å®œ", py: "piÃ¡nyi", uz: "Arzon", icon: "ğŸ·ï¸" },
            { zh: "ç¥¨", py: "piÃ o", uz: "Chipta", icon: "ğŸ«" },
            { zh: "å¦»å­", py: "qÄ«zi", uz: "Xotin", icon: "ğŸ’" },
            { zh: "èµ·åºŠ", py: "qÇchuÃ¡ng", uz: "O'rnidan turmoq", icon: "ğŸ›Œ" },
            { zh: "åƒ", py: "qiÄn", uz: "Ming (1000)", icon: "1ï¸âƒ£0ï¸âƒ£0ï¸âƒ£0ï¸âƒ£" },
            { zh: "é“…ç¬”", py: "qiÄnbÇ", uz: "Qalam", icon: "âœï¸" },
            { zh: "æ™´", py: "qÃ­ng", uz: "Quyoshli", icon: "â˜€ï¸" },
            { zh: "å»å¹´", py: "qÃ¹niÃ¡n", uz: "O'tgan yili", icon: "ğŸ“…" },
            { zh: "è®©", py: "rÃ ng", uz: "Ruxsat bermoq", icon: "ğŸ‘®" },
            { zh: "æ—¥", py: "rÃ¬", uz: "Kun", icon: "ğŸ“†" },
            { zh: "ä¸Šç­", py: "shÃ ngbÄn", uz: "Ishga borish", icon: "ğŸ¢" },
            { zh: "èº«ä½“", py: "shÄ“ntÇ", uz: "Sog'liq/Tana", icon: "ğŸ’ª" },
            { zh: "ç”Ÿç—…", py: "shÄ“ngbÃ¬ng", uz: "Kasal bo'lmoq", icon: "ğŸ¤’" },
            { zh: "ç”Ÿæ—¥", py: "shÄ“ngrÃ¬", uz: "Tug'ilgan kun", icon: "ğŸ‚" },
            { zh: "äº‹æƒ…", py: "shÃ¬qing", uz: "Ish/Hodisa", icon: "ğŸ“‹" },
            { zh: "æ‰‹è¡¨", py: "shÇ’ubiÇo", uz: "Qo'l soat", icon: "âŒš" },
            { zh: "æ—¶é—´", py: "shÃ­jiÄn", uz: "Vaqt", icon: "ğŸ•°ï¸" },
            { zh: "æ‰‹æœº", py: "shÇ’ujÄ«", uz: "Telefon", icon: "ğŸ“±" },
            { zh: "è¯´è¯", py: "shuÅhuÃ ", uz: "Gaplashmoq", icon: "ğŸ—£ï¸" },
            { zh: "é€", py: "sÃ²ng", uz: "Sovg'a qilmoq", icon: "ğŸ" },
            { zh: "è™½ç„¶", py: "suÄ«rÃ¡n", uz: "Biroq", icon: "âš–ï¸" },
            { zh: "å®ƒ", py: "tÄ", uz: "U (Narsa)", icon: "ğŸ¾" },
            { zh: "è¸¢è¶³çƒ", py: "tÄ« zÃºqiÃº", uz: "Futbol o'ynash", icon: "âš½" },
            { zh: "é¢˜", py: "tÃ­", uz: "Savol", icon: "â“" },
            { zh: "è·³èˆ", py: "tiÃ owÇ”", uz: "Raqsga tushish", icon: "ğŸ’ƒ" },
            { zh: "å¤–", py: "wÃ i", uz: "Tashqari", icon: "ğŸï¸" },
            { zh: "å®Œ", py: "wÃ¡n", uz: "Tugamoq", icon: "ğŸ" },
            { zh: "ç©", py: "wÃ¡n", uz: "O'ynamoq", icon: "ğŸ®" },
            { zh: "æ™šä¸Š", py: "wÇnshang", uz: "Kechqurun", icon: "ğŸŒƒ" },
            { zh: "å¾€", py: "wÇng", uz: "Tomonga", icon: "â¤´ï¸" },
            { zh: "ä¸ºä»€ä¹ˆ", py: "wÃ¨ishÃ©nme", uz: "Nima uchun", icon: "ğŸ¤·" },
            { zh: "é—®", py: "wÃ¨n", uz: "So'ramoq", icon: "ğŸ™‹" },
            { zh: "é—®é¢˜", py: "wÃ¨ntÃ­", uz: "Muammo/Savol", icon: "ğŸ§©" },
            { zh: "è¥¿ç“œ", py: "xÄ«guÄ", uz: "Tarvuz", icon: "ğŸ‰" },
            { zh: "å¸Œæœ›", py: "xÄ«wÃ ng", uz: "Umid qilmoq", icon: "ğŸ™" },
            { zh: "å°æ—¶", py: "xiÇoshÃ­", uz: "Soat (Vaqt)", icon: "âŒ›" },
            { zh: "ç¬‘", py: "xiÃ o", uz: "Kulmoq", icon: "ğŸ˜„" },
            { zh: "æ–°", py: "xÄ«n", uz: "Yangi", icon: "ğŸ†•" },
            { zh: "å§“", py: "xÃ¬ng", uz: "Familiya", icon: "ğŸ“›" },
            { zh: "ä¼‘æ¯", py: "xiÅ«xi", uz: "Dam olmoq", icon: "ğŸ›‹ï¸" },
            { zh: "é›ª", py: "xuÄ›", uz: "Qor", icon: "â„ï¸" },
            { zh: "é¢œè‰²", py: "yÃ¡nsÃ¨", uz: "Rang", icon: "ğŸ¨" },
            { zh: "çœ¼ç›", py: "yÇnjing", uz: "Ko'z", icon: "ğŸ‘ï¸" },
            { zh: "ç¾Šè‚‰", py: "yÃ¡ngrÃ²u", uz: "Qo'y go'shti", icon: "ğŸ–" },
            { zh: "è¯", py: "yÃ o", uz: "Dori", icon: "ğŸ’Š" },
            { zh: "è¦", py: "yÃ o", uz: "Kerak/Xohlamoq", icon: "ğŸ¤²" },
            { zh: "ä¹Ÿ", py: "yÄ›", uz: "Ham", icon: "â•" },
            { zh: "ä¸€èµ·", py: "yÄ«qÇ", uz: "Birgalikda", icon: "ğŸ‘«" },
            { zh: "ä¸€ä¸‹", py: "yÄ«xiÃ ", uz: "Bir oz", icon: "ğŸ¤" },
            { zh: "å·²ç»", py: "yÇjÄ«ng", uz: "Allaqachon", icon: "ğŸ•°ï¸" },
            { zh: "æ„æ€", py: "yÃ¬si", uz: "Ma'no", icon: "ğŸ“–" },
            { zh: "å› ä¸º", py: "yÄ«nwÃ¨i", uz: "Chunki", icon: "ğŸ’¡" },
            { zh: "é˜´", py: "yÄ«n", uz: "Bulutli", icon: "â˜ï¸" },
            { zh: "æ¸¸æ³³", py: "yÃ³uyÇ’ng", uz: "Suzmoq", icon: "ğŸŠ" },
            { zh: "å³è¾¹", py: "yÃ²ubian", uz: "O'ng tomon", icon: "â¡ï¸" },
            { zh: "é±¼", py: "yÃº", uz: "Baliq", icon: "ğŸŸ" },
            { zh: "è¿œ", py: "yuÇn", uz: "Uzoq", icon: "ğŸ”­" },
            { zh: "è¿åŠ¨", py: "yÃ¹ndÃ²ng", uz: "Sport", icon: "ğŸ‹ï¸" },
            { zh: "å†", py: "zÃ i", uz: "Yana", icon: "ğŸ”" },
            { zh: "æ—©ä¸Š", py: "zÇoshang", uz: "Ertalab", icon: "ğŸŒ…" },
            { zh: "ä¸ˆå¤«", py: "zhÃ ngfu", uz: "Er", icon: "ğŸ¤µ" },
            { zh: "æ‰¾", py: "zhÇo", uz: "Qidirmoq", icon: "ğŸ”" },
            { zh: "ç€", py: "zhe", uz: "(Holat)", icon: "ğŸ“Œ" },
            { zh: "çœŸ", py: "zhÄ“n", uz: "Rost", icon: "âœ…" },
            { zh: "æ­£åœ¨", py: "zhÃ¨ngzÃ i", uz: "Ayni paytda", icon: "â³" },
            { zh: "çŸ¥é“", py: "zhÄ«dÃ o", uz: "Bilmoq", icon: "ğŸ§ " },
            { zh: "å‡†å¤‡", py: "zhÇ”nbÃ¨i", uz: "Tayyorlanmoq", icon: "ğŸ’" },
            { zh: "èµ°", py: "zÇ’u", uz: "Yurmoq", icon: "ğŸš¶" },
            { zh: "æœ€", py: "zuÃ¬", uz: "Eng", icon: "ğŸ”" },
            { zh: "å·¦è¾¹", py: "zuÇ’bian", uz: "Chap tomon", icon: "â¬…ï¸" }
        ];

        const gridApp = document.getElementById('grid-app');
        const totalCountEl = document.getElementById('total-count');
        const modal = document.getElementById('ai-modal');
        const modalContent = document.getElementById('modal-content');
        const modalLoading = document.getElementById('modal-loading');

        // Initializatsiya
        function init() {
            totalCountEl.textContent = vocabData.length;
            renderGrid(vocabData);
            adjustSubtitleKerning(); // Bo'shliqni to'g'irlash
            if ('speechSynthesis' in window) {
                window.speechSynthesis.getVoices();
            }
        }

        function adjustSubtitleKerning() {
            const subtitleEl = document.getElementById('subtitle-text');
            if (subtitleEl) {
                // 'o' va 'Ê»' orasidagi bo'shliqni qo'lda to'g'irlash
                subtitleEl.innerHTML = subtitleEl.innerHTML.replace(
                    /o'/g, 
                    'o<span style="margin-left: -0.1em;">\'</span>'
                );
            }
        }

        // To'rni chizish
        function renderGrid(data) {
            gridApp.innerHTML = '';
            
            data.forEach((item) => {
                const cardWrapper = document.createElement('div');
                cardWrapper.className = 'card-container noselect';
                
                let fontSize = 80;
                if (item.zh.length === 2) fontSize = 60;
                if (item.zh.length === 3) fontSize = 45;
                if (item.zh.length > 3) fontSize = 35;

                // Haqiqiy rasm uchun Pollinations AI dan foydalanish
                const imageUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(item.key)}?width=300&height=200&nologo=true`;

                cardWrapper.innerHTML = `
                    <div class="card-inner" onclick="toggleFlip(this)">
                        <!-- Old tomoni -->
                        <div class="card-face card-front">
                            <svg width="100%" height="100%" viewBox="0 0 300 225" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="150" cy="112" r="90" fill="#fee2e2" opacity="0.6" />
                                <text x="50%" y="55%" dominant-baseline="middle" text-anchor="middle" 
                                      font-family="'Noto Serif SC', sans-serif" font-weight="bold" font-size="${fontSize}" fill="#450a0a">
                                    ${item.zh}
                                </text>
                                <text x="50%" y="85%" dominant-baseline="middle" text-anchor="middle" 
                                      font-size="10" fill="#ef4444">Bosish</text>
                            </svg>
                            <button onclick="speakWord('${item.zh}', event)" class="absolute top-2 right-2 w-8 h-8 rounded-full bg-red-50 hover:bg-[#b91c1c] hover:text-white text-[#b91c1c] flex items-center justify-center transition-colors shadow-sm border border-red-100" aria-label="Listen">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                            </button>
                        </div>

                        <!-- Orqa tomoni -->
                        <div class="card-face card-back relative group flex flex-col justify-center">
                            <!-- Rasm maydoni -->
                            <div class="real-image flex items-center justify-center text-6xl bg-gray-50 mt-16">
                                ${item.icon}
                            </div>
                            
                            <!-- Matn maydoni -->
                            <div class="flex-1 flex flex-col justify-center items-center w-full bg-white pb-2">
                                <div class="text-[#0099B5] font-bold text-xl mb-1 mt-2">${item.py}</div>
                                <div class="text-[#1EB53A] font-bold text-lg uppercase px-2 leading-tight">${item.uz}</div>
                            </div>

                            <!-- Ovoz tugmasi -->
                            <button onclick="speakWord('${item.zh}', event)" class="absolute bottom-2 right-2 w-8 h-8 rounded-full bg-green-50 hover:bg-[#1EB53A] hover:text-white text-[#1EB53A] flex items-center justify-center transition-colors shadow-sm border border-green-100">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                            </button>
                            
                            <!-- AI tugmasi (sehrli tayoqcha) -->
                            <button onclick="generateAIExample('${item.zh}', '${item.py}', '${item.uz}', event)" class="absolute top-2 left-2 w-8 h-8 rounded-full bg-indigo-50 hover:bg-indigo-500 hover:text-white text-indigo-500 flex items-center justify-center transition-colors shadow-sm border border-indigo-100" title="AI Example">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                  <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
                gridApp.appendChild(cardWrapper);
            });
        }

        // Gemini AI chaqiruvi
        async function generateAIExample(word, pinyin, uzbek, event) {
            if (event) event.stopPropagation();
            
            // Modal va yuklanishni ko'rsatish
            modal.classList.remove('hidden');
            modalContent.innerHTML = '';
            modalLoading.classList.remove('hidden');

            const prompt = `Generate a very simple Chinese sentence (HSK2 level) using the word "${word}" (${pinyin}). 
            Also provide Pinyin for the sentence and Uzbek translation.
            Format exactly like this:
            [Chinese Sentence]
            [Pinyin]
            [Uzbek Translation]
            Do not add labels like "Chinese:" or "Pinyin:". Just the lines.`;

            try {
                // Qayta urinish mantiqi
                const fetchWithRetry = async (url, options, retries = 3, backoff = 1000) => {
                    try {
                        const response = await fetch(url, options);
                        if (!response.ok) {
                            if (response.status === 429 && retries > 0) {
                                await new Promise(r => setTimeout(r, backoff));
                                return fetchWithRetry(url, options, retries - 1, backoff * 2);
                            }
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return await response.json();
                    } catch (e) {
                        if (retries > 0) {
                            await new Promise(r => setTimeout(r, backoff));
                            return fetchWithRetry(url, options, retries - 1, backoff * 2);
                        }
                        throw e;
                    }
                };

                const responseData = await fetchWithRetry(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }]
                        })
                    }
                );

                const text = responseData.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (text) {
                    // Oddiy formatlash
                    const lines = text.split('\n').filter(line => line.trim() !== '');
                    let html = '';
                    
                    if (lines.length >= 1) html += `<div class="text-2xl text-slate-800 font-bold mb-1">${lines[0]}</div>`;
                    if (lines.length >= 2) html += `<div class="text-lg text-[#0099B5] font-medium mb-3">${lines[1]}</div>`;
                    if (lines.length >= 3) html += `<div class="text-base text-[#1EB53A] italic bg-green-50 p-2 rounded border border-green-100">${lines.slice(2).join(' ')}</div>`;
                    
                    // Agar AI chiqishi turlicha bo'lsa, zaxira formatlash
                    if (lines.length === 0) html = `<p>${text}</p>`;

                    modalContent.innerHTML = html;
                } else {
                    modalContent.innerHTML = `<p class="text-red-500">Kechirasiz, xatolik yuz berdi. (Sorry, error generating text.)</p>`;
                }

            } catch (error) {
                console.error("AI Error:", error);
                modalContent.innerHTML = `<p class="text-red-500">Internet connection error or AI limit reached.</p>`;
            } finally {
                modalLoading.classList.add('hidden');
            }
        }

        // AI yaratgan matnni o'qish
        function speakAiContent() {
            const chineseTextDiv = modalContent.querySelector('.text-2xl');
            if (chineseTextDiv) {
                const text = chineseTextDiv.innerText;
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'zh-CN';
                    utterance.rate = 0.8;
                    const voices = window.speechSynthesis.getVoices();
                    const zhVoice = voices.find(voice => voice.lang.includes('zh') || voice.lang.includes('CN'));
                    if (zhVoice) utterance.voice = zhVoice;
                    window.speechSynthesis.speak(utterance);
                }
            }
        }

        function toggleFlip(element) {
            element.classList.toggle('is-flipped');
        }

        function speakWord(text, event) {
            if (event) event.stopPropagation();
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const cleanText = text.replace(/[^\u4e00-\u9fa5]/g, '');
                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.lang = 'zh-CN';
                utterance.rate = 0.8; 
                const voices = window.speechSynthesis.getVoices();
                const zhVoice = voices.find(voice => voice.lang.includes('zh') || voice.lang.includes('CN'));
                if (zhVoice) utterance.voice = zhVoice;
                window.speechSynthesis.speak(utterance);
            }
        }

        function closeModal() {
            modal.classList.add('hidden');
        }

        // Tashqariga bosilganda modalni yopish
        modal.addEventListener('click', function(e) {
            if (e.target === modal) closeModal();
        });

        // Boshlash
        init();

    </script>
</body>
</html>